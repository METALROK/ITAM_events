<script lang="ts">
	import { onMount } from "svelte";
	import { goto } from "$app/navigation";
    import {apiUrl} from '$lib/index';
	let c = "01";
    let d = Number(c);
    console.log(d);
	let objects = [];

	async function fetchObjects() {
		try {
			const response = await fetch(`${apiUrl}`, {
        credentials: 'same-origin',
				method: "GET",
				headers: { "Content-Type": "application/json" }
			});
			// if (!response.ok) {
			// 	throw new Error(`Ошибка ${response.status}  ${response.statusText}`);
			// }
			// const text = await response.text();
			// if (!text) {
			// 	throw new Error("Ответ от сервера пустой");
			// }
			objects = await response.json();
			// const data = JSON.parse(text);
			// console.log(`Полученные данные: ${data}`);
			// return data;
		} catch (error) {
			console.error("Ошибка загрузки", error);
			throw error;
		}
	}

	onMount(async () => {
		await fetchObjects();
	});

	function goToAddPage() {
		goto("/create_event");
	}

	function goToObjectPage(id) {
		goto(`/${id}`);
	}

	async function deleteEvent(id) {
		try{
			const response = await fetch(`${apiUrl}${id}`, {method: "DELETE",headers: { "Content-Type": "application/json" }});
			if (response.ok){
				objects = objects.filter((obj)=>obj.id !==id);
			}
			else {
				const error = await response.json();
				alert("Error: " + error.message);
			}
		}
		catch (error){
			console.error("Error: ", error);
		}
		
	}
</script>
<header>
    <div class="header">
      <div class="logo"><svg width="76.08" height="39" viewBox="0 0 77 39" fill="none" xmlns="http://www.w3.org/2000/svg">
		<path d="M3.44771 6.72399V23.3907H0.129883V6.72399H3.44771ZM3.44771 0.057312V3.39065H0.129883V0.057312H3.44771Z" fill="#323F47"/>
		<path d="M22.8557 16.724V20.0573H19.5379V16.724H22.8557ZM12.9022 3.39062V23.3906H11.9401C11.2544 23.3906 10.6904 23.1684 10.248 22.724C9.80561 22.2795 9.58441 21.7128 9.58441 21.024V3.39062H12.9022ZM19.5379 20.0573V23.3906H12.9022V20.0573H19.5379ZM19.5379 6.72396V10.0573H6.2666V6.72396H19.5379Z" fill="#323F47"/>
		<path d="M37.9616 6.72396H41.2797V23.3906H37.9616V6.72396ZM24.6904 13.224C24.6904 11.8017 25.0554 10.5795 25.7853 9.55729C26.5152 8.53506 27.5106 7.75729 28.7713 7.22396C30.0542 6.66839 31.4698 6.39062 33.0181 6.39062C34.5442 6.39062 35.938 6.66839 37.1985 7.22396C38.4593 7.75729 39.4547 8.53506 40.1846 9.55729C40.9145 10.5795 41.2797 11.8017 41.2797 13.224V16.524C41.2797 17.9462 40.9145 19.1795 40.1846 20.224C39.4547 21.2462 38.4593 22.0351 37.1985 22.5906C35.938 23.124 34.5442 23.3906 33.0181 23.3906C31.4698 23.3906 30.0542 23.124 28.7713 22.5906C27.5106 22.0351 26.5152 21.2462 25.7853 20.224C25.0554 19.1795 24.6904 17.9462 24.6904 16.524V13.224ZM28.0082 16.0573C28.0082 17.5462 28.517 18.5906 29.5345 19.1906C30.574 19.7684 31.7353 20.0573 33.0181 20.0573C34.2569 20.0573 35.3848 19.7684 36.4024 19.1906C37.4197 18.5906 37.9284 17.5462 37.9284 16.0573V13.6906C37.9284 12.2017 37.4197 11.1684 36.4024 10.5906C35.4071 10.0128 34.2788 9.72396 33.0181 9.72396C31.7353 9.72396 30.574 10.0128 29.5345 10.5906C28.517 11.1684 28.0082 12.2017 28.0082 13.6906V16.0573ZM34.6439 13.224V16.5573H31.3261V13.224H34.6439Z" fill="#323F47"/>
		<path d="M59.2901 14.0573C59.2901 12.5684 58.7814 11.535 57.7638 10.9573C56.7465 10.3573 55.6182 10.0573 54.3796 10.0573C53.0969 10.0573 51.9354 10.3573 50.8958 10.9573C49.8785 11.535 49.3698 12.5684 49.3698 14.0573V16.4239L46.0518 16.8906V13.5906C46.0518 12.1684 46.4169 10.9461 47.1468 9.92394C47.8768 8.87947 48.8721 8.0906 50.133 7.55727C51.4157 7.0017 52.8314 6.72394 54.3796 6.72394C55.9059 6.72394 57.2883 7.0017 58.5269 7.55727C59.7878 8.0906 60.7831 8.87947 61.513 9.92394C62.243 10.9461 62.6078 12.1684 62.6078 13.5906V23.3906H59.2901V14.0573ZM49.3698 13.0573V23.3906H46.0518V13.0573H49.3698ZM75.8793 20.0573V23.3906H72.5612V20.0573H75.8793ZM72.528 14.0573C72.528 12.5684 72.0193 11.535 71.002 10.9573C69.9844 10.3573 68.8565 10.0573 67.6179 10.0573C66.3348 10.0573 65.1736 10.3573 64.1341 10.9573C63.0945 11.535 62.5745 12.5684 62.5745 14.0573V16.4239L59.2901 16.8906V13.5906C59.2901 12.1684 59.6549 10.9461 60.3848 9.92394C61.1147 8.87947 62.1101 8.0906 63.3709 7.55727C64.6537 7.0017 66.0693 6.72394 67.6179 6.72394C69.1438 6.72394 70.5376 7.0017 71.7981 7.55727C73.0589 8.0906 74.0543 8.87947 74.7842 9.92394C75.5141 10.9461 75.8793 12.1684 75.8793 13.5906V20.0573H72.528V14.0573ZM47.0804 6.72394V10.0573H43.7627V6.72394H47.0804Z" fill="#323F47"/>
		<path d="M1.40639 28.5714V38.8173H0.129883V28.5714H1.40639Z" fill="#323F47"/>
		<path d="M6.26508 28.5714V38.8173H4.98857V28.5714H6.26508ZM8.81808 28.5714V29.8521H2.43555V28.5714H8.81808Z" fill="#323F47"/>
		<path d="M22.4581 34.3346V35.6153H17.2755V34.3346H22.4581ZM20.5689 28.5714L16.8671 38.8173H15.4629L19.1648 28.5714H20.5689ZM24.2708 38.8173H22.8666L19.1648 28.5714H20.5689L24.2708 38.8173Z" fill="#323F47"/>
		<path d="M27.2084 28.5714V38.8173H25.9319V28.5714H27.2084ZM29.7615 28.5714V29.8521H23.3789V28.5714H29.7615Z" fill="#323F47"/>
		<path d="M37.6817 28.5714V38.8173H36.4053V28.5714H37.6817ZM39.0861 28.5714L43.0433 38.8173H41.639L37.6817 28.5714H39.0861ZM39.0861 28.5714V29.8521H36.4053V28.5714H39.0861ZM48.4046 38.8173H47.1278V28.5714H48.4046V38.8173ZM43.1709 38.8173H41.7666L45.7238 28.5714H47.1278L43.1709 38.8173ZM48.4046 29.8521H45.7238V28.5714H48.4046V29.8521Z" fill="#323F47"/>
		<path d="M51.3321 28.5714V38.8173H50.0557V28.5714H51.3321Z" fill="#323F47"/>
		<path d="M52.8604 31.8501C52.8604 31.1329 53.0816 30.5181 53.5242 30.0058C53.9667 29.4936 54.5411 29.1051 55.2475 28.8404C55.9624 28.5757 56.7239 28.4434 57.5326 28.4434C58.3153 28.4434 59.0346 28.5757 59.6898 28.8404C60.345 29.0965 60.8895 29.4807 61.3237 29.993C61.7663 30.5053 62.0556 31.1243 62.1915 31.8501H60.6855C60.4642 31.1243 60.0685 30.6121 59.4981 30.3132C58.9366 30.0058 58.2814 29.8522 57.5326 29.8522C56.7156 29.8522 55.9837 30.0101 55.3368 30.326C54.69 30.6334 54.3667 31.1414 54.3667 31.8501H52.8604ZM54.3667 35.5643C54.588 36.2813 54.9794 36.7893 55.5412 37.0883C56.1113 37.387 56.7751 37.5363 57.5326 37.5363C58.3496 37.5363 59.0771 37.3827 59.7154 37.0753C60.3619 36.768 60.6855 36.26 60.6855 35.5513H62.2045C62.2045 36.2687 61.9832 36.8833 61.5407 37.3957C61.1068 37.908 60.5323 38.2963 59.8174 38.561C59.1024 38.8173 58.3409 38.9453 57.5326 38.9453C56.7409 38.9453 56.0176 38.8173 55.3624 38.561C54.7073 38.305 54.1581 37.925 53.7155 37.4213C53.2816 36.909 52.9966 36.29 52.8604 35.5643H54.3667ZM60.6855 35.5513C60.6855 35.3293 60.5619 35.1543 60.3151 35.0263C60.0685 34.8897 59.7579 34.7873 59.3835 34.719C59.009 34.6507 58.4771 34.5737 57.7877 34.4883C56.7664 34.369 55.9239 34.2363 55.2601 34.0913C54.6049 33.9463 54.0391 33.6987 53.5624 33.3487C53.0946 32.9899 52.8604 32.4904 52.8604 31.8501H54.3667C54.3667 32.1318 54.5029 32.3538 54.775 32.5161C55.0475 32.6783 55.3923 32.7978 55.8093 32.8747C56.2262 32.943 56.7963 33.0113 57.5196 33.0796C58.5153 33.182 59.3237 33.3016 59.9449 33.4383C60.5662 33.5663 61.0981 33.7967 61.5407 34.1297C61.9832 34.4627 62.2045 34.9367 62.2045 35.5513H60.6855Z" fill="#323F47"/>
		<path d="M65.0069 28.5714V38.8173H63.7305V28.5714H65.0069Z" fill="#323F47"/>
		<path d="M66.5352 31.8501C66.5352 31.1329 66.7564 30.5181 67.199 30.0058C67.6415 29.4936 68.2159 29.1051 68.9223 28.8404C69.6369 28.5757 70.3987 28.4434 71.2071 28.4434C71.9901 28.4434 72.7091 28.5757 73.3646 28.8404C74.0198 29.0965 74.5643 29.4807 74.9985 29.993C75.4407 30.5053 75.7301 31.1243 75.8663 31.8501H74.36C74.1387 31.1243 73.743 30.6121 73.1729 30.3132C72.6114 30.0058 71.9559 29.8522 71.2071 29.8522C70.3901 29.8522 69.6582 30.0101 69.0116 30.326C68.3648 30.6334 68.0415 31.1414 68.0415 31.8501H66.5352ZM68.0415 35.5643C68.2628 36.2813 68.6542 36.7893 69.216 37.0883C69.7861 37.387 70.4499 37.5363 71.2071 37.5363C72.024 37.5363 72.7516 37.3827 73.3898 37.0753C74.0367 36.768 74.36 36.26 74.36 35.5513H75.8793C75.8793 36.2687 75.658 36.8833 75.2155 37.3957C74.7812 37.908 74.2068 38.2963 73.4922 38.561C72.7772 38.8173 72.0157 38.9453 71.2071 38.9453C70.4157 38.9453 69.6924 38.8173 69.0372 38.561C68.3817 38.305 67.8329 37.925 67.3903 37.4213C66.9564 36.909 66.6714 36.29 66.5352 35.5643H68.0415ZM74.36 35.5513C74.36 35.3293 74.2367 35.1543 73.9899 35.0263C73.743 34.8897 73.4324 34.7873 73.0579 34.719C72.6835 34.6507 72.1516 34.5737 71.4625 34.4883C70.4412 34.369 69.5987 34.2363 68.9349 34.0913C68.2797 33.9463 67.7139 33.6987 67.2372 33.3487C66.769 32.9899 66.5352 32.4904 66.5352 31.8501H68.0415C68.0415 32.1318 68.1777 32.3538 68.4498 32.5161C68.7223 32.6783 69.0668 32.7978 69.4837 32.8747C69.9007 32.943 70.4711 33.0113 71.1944 33.0796C72.1901 33.182 72.9985 33.3016 73.6197 33.4383C74.241 33.5663 74.7729 33.7967 75.2155 34.1297C75.658 34.4627 75.8793 34.9367 75.8793 35.5513H74.36Z" fill="#323F47"/>
		</svg>
		</div>
      <nav>
        <button class="nav-btn" >Мероприятия</button>
        <button class="nav-btn">Календарь</button>
		<div class="avatar"><svg width="54" height="54" viewBox="0 0 54 55" fill="none" xmlns="http://www.w3.org/2000/svg">
			<rect y="0.5" width="54" height="54" rx="27" fill="white"/>
			<path d="M35 36.5V34.5C35 33.4391 34.5786 32.4217 33.8284 31.6716C33.0783 30.9214 32.0609 30.5 31 30.5H23C21.9391 30.5 20.9217 30.9214 20.1716 31.6716C19.4214 32.4217 19 33.4391 19 34.5V36.5" stroke="#7D4FA7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
			<path d="M27 26.5C29.2091 26.5 31 24.7091 31 22.5C31 20.2909 29.2091 18.5 27 18.5C24.7909 18.5 23 20.2909 23 22.5C23 24.7091 24.7909 26.5 27 26.5Z" stroke="#7D4FA7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
			</svg></div>
      </nav>
    </div>
  </header>
<main>
	<h1>Мероприятия</h1>
	<div class="filter-bar">
        <select>
          <option selected>Выбрать категорию</option>
		  <option>Хакатон</option>
		  <option>Митап</option>
        </select>
        <select>
          <option selected>Формат проведения</option>
		  <option>Онлайн</option>
		  <option>Офлайн</option>
        </select>
        <input type="text" placeholder="Поиск...">
      </div>
	<button on:click={goToAddPage}>Добавить событие</button>
	<ul>
		{#each objects as obj (obj.id)}
		<div class="card">
			<li on:click={() => goToObjectPage(obj.id)}>
				
				<span class="event-tag">{obj.tags}</span> <br>
				<h2>{obj.name}</h2>
				<p>{obj.content}</p>
				<small>{obj.start_datetime}</small>
			</li>
			<button on:click={()=>deleteEvent(obj.id)}><svg width="26" height="26" viewBox="0 0 26 26" fill="none" xmlns="http://www.w3.org/2000/svg">
				<path d="M3.25 6.5H5.41667H22.75" stroke="#787878" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
				<path d="M20.5832 6.50002V21.6667C20.5832 22.2413 20.3549 22.7924 19.9486 23.1988C19.5422 23.6051 18.9911 23.8334 18.4165 23.8334H7.58317C7.00853 23.8334 6.45743 23.6051 6.05111 23.1988C5.64478 22.7924 5.4165 22.2413 5.4165 21.6667V6.50002M8.6665 6.50002V4.33335C8.6665 3.75872 8.89478 3.20762 9.30111 2.80129C9.70744 2.39496 10.2585 2.16669 10.8332 2.16669H15.1665C15.7411 2.16669 16.2922 2.39496 16.6986 2.80129C17.1049 3.20762 17.3332 3.75872 17.3332 4.33335V6.50002" stroke="#787878" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
				</svg>
				</button>
			</div>
		{/each}
	</ul>
</main>

<style>

	header{margin-top: 25px;
		margin-left: 23px;
		margin-right: 23px;
		padding: 18px 37px;
        background: linear-gradient(to right, #FCCDCD, #C8AAE7);
		border-radius: 60px;
		height: 91;
	}
	.header {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
	  .logo{
		margin-top:7.5;
		margin-bottom: 7.5;
		margin-left: 19;
	  }
	  .nav-btn {
        background: white;
        border: none;
        border-radius: 40px;
        padding: 10px 20px;
        cursor: pointer;
      }
	  nav{
		display: flex;
	  }
	  .avatar{
		margin-left: 16px;
	  }
	  .event-tag {
        position: absolute;
        top: 23;
        left: 23;
        background: #D9D9D9;
        color: #666666;
        padding: 7px 23px;
        font-size: 12px;
        border-radius: 20;
      }

	
</style>
